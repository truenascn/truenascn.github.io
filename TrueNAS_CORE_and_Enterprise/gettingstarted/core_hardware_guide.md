# TrueNAS CORE 硬件指南

从重新利用的系统到高度定制的构建，TrueNAS 的基本自由是能够在几乎所有 x86 计算机上运行它。

## 推荐的最低硬件要求

| 处理器（CPU）                        | 内存   | 启动盘    | 数据盘                                  |
| ------------------------------------ | ------ | --------- | --------------------------------------- |
| 2 核 Intel 64 位或 AMD x86_64 处理器 | 16 GiB | 16 GB SSD | 用于一个存储池的另外 2 个相同大小的硬盘 |

TrueNAS CORE 安装程序建议使用至少 8 GB RAM。 TrueNAS CORE 安装、运行、操作Jails、托管 SMB 共享，复制 TB级的数据至少需要 8GB RAM。 iXsystem 建议使用表格上的硬件以获得更好的性能和并避免产生更多的问题。

TrueNAS可以不需要 SSD 作为引导设备。 出于使用寿命的原因，iXSystems 不鼓励使用SD卡或 U盘作为启动盘。 iXSystems 不鼓励在单个磁盘或条带池上安装 TrueNAS CORE，除非有充分的理由这样做。 TrueNAS CORE 可以在没有任何数据设备的情况下安装和运行，但也不鼓励这样做。

不需要双路CPU，因为大多数半现代 64 位 CPU 可能已经至少有两个内核。

如需根据您独特的性能、存储和网络要求构建系统的帮助，请继续阅读！

## 存储注意事项

任何存储系统的核心都是其文件系统与其物理存储设备的共生配对。 TrueNAS 中的 ZFS 文件系统不惜一切代价提供任何文件系统的最佳可用数据保护，并且非常有效地利用机械硬盘和全闪存存储，或两者的混合。 ZFS 已为存储设备的故障做好了充分的准备。 它具有高度可配置性，可实现冗余和性能的完美平衡，以满足任何存储目标。 正确配置的 TrueNAS 系统可以容忍多个存储设备的故障，甚至可以使用配置文件的副本重新创建其启动媒体。

### 存储媒体介质

选择存储介质是设计存储系统以满足当前目标并为未来容量扩展做准备的第一步。

##### 普通SATA磁盘

在存储介质的下一个科学突破之前，由于容量和成本的平衡，旋转硬盘一直存在。 两位数 TB 的消费者和企业驱动器的到来为 TrueNAS 用户提供了比以往更多的选择。 TrueNAS Mini 系统附带 Western Digital NAS 和 NL-SAS 是有充分理由的，了解替代方案可以解释这一决定。

##### NAS专用SATA盘

串行高级技术附件 (SATA) 仍然是许多台式机/笔记本电脑、服务器和一些非企业存储阵列中的事实上的标准磁盘接口。 SATA 磁盘最初提供两位数的千兆字节容量，现在生产以满足无数的容量、可靠性和性能目标。虽然消费级台式机 SATA 磁盘没有它们曾经遇到的整体可靠性问题，但它们仍然不是为连续运行或在 RAID 组中使用而设计或保证的。企业 SATA 磁盘解决了存储系统中所需的“永远在线”因素、振动容限和驱动器错误处理，但台式机和企业 SATA 驱动器之间的价格差异足以促使用户将其消费驱动器推向 24/7追求成本节约的服务。

驱动器供应商可能厌倦了为在错误应用中使用的故障桌面驱动器提供保修，通过生产 NAS 驱动器来应对市场上的这一差距，该驱动器因采用 CMR/PMR 技术的原始西部数据 (WD) Red™ 驱动器而闻名（现在称为WD 红盘）。西部数据设计的 WD Red™ Plus NAS 驱动器（非 SMR）用于具有多达 8 个硬盘驱动器的系统，或用于多达 16 个驱动器的 [WD Red™ Pro](https://www.westerndigital.com/products/internal-drives/wd-red-pro-sata-hdd) 驱动器，以及用于超过 16 个驱动器的系统的 [WD UltraStar™](https://www.westerndigital.com/products/data-center-platforms) 驱动器.

由于其卓越的质量和可靠性，WD 硬盘在 iXsystems 社区论坛中被称为 TrueNAS 构建的首选硬盘。除非另有要求，所有 TrueNAS Mini 均随附 WD Red™ Plus 驱动器。

##### 近线SAS 硬盘

Nearline SAS (NL-SAS) 磁盘是 7200 RPM 企业级 SATA 磁盘，具有大多数企业存储系统中的行业标准 SAS 接口。 SAS 代表 Serial Attached SCSI，具有串行形式的传统 SCSI 磁盘接口。 SAS 系统专为数据中心存储应用程序设计，具有准确、详细的错误处理、可预测的故障行为、可靠的热插拔以及多路径支持的附加功能。多路径访问意味着每个驱动器都有两个接口，可以连接到两个存储控制器或通过两条电缆连接到一个控制器。在 TrueNAS 高可用性架构的情况下，这种冗余可以防止电缆、控制器卡或整个系统故障，其中每个控制器都是访问同一组 NL-SAS 驱动器的独立服务器。 NL-SAS 驱动器也足够强大，可以处理具有 16 个以上磁盘的严苛系统。因此，由于 NL-SAS 驱动器提供的容量、可靠性、性能和灵活性的全面完美平衡，面向容量的 TrueNAS 系统配备了西部数据 [UltraStar NL-SAS](https://www.westerndigital.com/products/data-center-platforms) 磁盘。

##### SAS 硬盘

企业 SAS 磁盘专为实现最高性能和旋转盘片所能提供的可靠性而构建，是企业存储行业的传统重担。 与 NL-SAS 或 NAS 驱动器相比，SAS 磁盘容量较低，因为盘片旋转速度高达 15,000 RPM。 虽然 SAS 驱动器听起来像是高性能存储的最终答案，但许多基于消费者和企业闪存的选项已经进入市场并显着降低了 SAS 驱动器的竞争力。 例如，2016 年，TrueNAS 产品线停产的企业级 SAS 硬盘几乎完全被闪存驱动器（SSD 或 NVMe）取代，因为它们具有卓越的性能/成本比。

##### 基于SATA 和 SAS 的 SSD固态硬盘

近年来闪存技术的重大进步推动了移动设备的革命以及闪存在通用 PC 和服务器中的兴起。与硬盘不同，闪存对振动不敏感，而且速度更快，可靠性相当。闪存每 GB 的价格仍然更高，但随着价格差距的缩小，闪存正在以多种方式进入 TrueNAS 系统。

将闪存引入主流市场的最短路径是供应商使用标准 SATA/SAS 硬盘接口和模拟标准硬盘但没有移动部件的外形。因此，闪存固态硬盘 (SSD) 具有 SATA 接口，大小与 2.5 英寸笔记本电脑硬盘相当，可以直接替代传统硬盘。闪存存储 SSD 可以取代 HDD 作为 TrueNAS 系统上的主存储，从而实现更快的速度，尽管是更小或更昂贵的存储解决方案。如果采用全闪存，请购买预算允许的最高质量闪存存储 SSD，重点关注与预期写入工作负载相匹配的电源安全性和写入耐久性。

##### NVME固态硬盘

虽然通过传统的SATA/SAS让 SSD 假装它们是 HDD 以供快速采用是有道理的，但非易失性内存快速 (NVMe) 标准是一种原生闪存协议，它充分利用了闪存的非线性和并行特性。 NVMe 的主要优势通常是其低延迟性能，并且它正在成为启动和其他任务的主流选择。 虽然最初仅限于 PCIe 和 M.2 等扩展卡外形规格，但新的 U.2 接口提供了一种相当通用的解决方案，其中包括 2.5 英寸驱动器外形规格和可从外部访问（但通常不可热插拔）的 NVMe 界面。 请注意，NVMe 设备可能会运行得很热，并且可能需要专用的散热器。

##### USB硬盘

避免将 USB 接口的硬盘用于 TrueNAS 的主存储，但您可以在紧要关头将它们用于非常基本的备份。 虽然 TrueNAS 不会自动执行此过程，但您可以连接 USB 硬盘，在命令行中复制，然后将其带到异地以进行安全保存。

您可以将这些存储设备介质组合使用以创建强大的存储解决方案。

### 存储解决方案

##### 混合存储和闪存缓存 (SLOG/ZIL/L2ARC)

通过提供两位数 TB 容量的硬盘和提供更高性能的基于闪存的选项，可提供两全其美的选项。借助 TrueNAS 和 OpenZFS，您可以合并闪存和磁盘以创建充分利用两种存储类型的混合存储。在混合配置中，大容量旋转磁盘存储数据，而 DRAM 和闪存充当超快速读写缓存。这些技术与基于闪存的独立写入日志 (SLOG) 结合使用，将其视为保存所谓的 ZFS 意图日志 (ZIL) 的写入缓存，用于加速写入。在读取方面，闪存是二级自适应替换（读取）缓存 (L2ARC)，用于将最频繁读取的数据集保存在速度更快的闪存介质上。具有同步写入的工作负载（例如 NFS 和数据库）受益于 SLOG 设备，而具有频繁访问数据的工作负载可能受益于 L2ARC 设备。 L2ARC 设备并不总是最佳选择，因为 RAM 中的一级 ARC [总是提供更快的缓存](https://www.ixsystems.com/blog/visualizing-zfs-performance/)，而 L2ARC 表使用一些 RAM。

SLOG 设备不需要很大。它只需要为网络或本地应用程序提供的五秒数据写入提供服务。大小介于 8 GB 和 32 GB 之间的高耐用性、低延迟设备足以满足大多数现代网络的需求，您可以剥离或镜像多个设备以实现性能或冗余。必须注意设备的耐用性与寿命，因为 SLOG 充当对系统进行的大多数写入的端点。

SLOG 设备具有电源保护也很重要。 ZFS 意图日志 (ZIL) 以及 SLOG 的目的是在发生崩溃或电源故障时保持同步写入的安全。如果 SLOG 没有电源保护并且在断电后丢失数据，那么它首先就违背了使用 SLOG 的目的！检查制造商的规格以确保 SLOG 设备电源安全或具有断电/故障保护。

随机读取性能是 L2ARC 设备中最重要的品质。它需要支持比它缓存的主存储介质更多的 IOPS。例如，在 40 个 SSD 池之前使用单个 SSD 作为 L2ARC 是无效的，因为 40 个 SSD 能够处理比单个 L2ARC 驱动器多得多的 IOPS。至于容量，比 RAM 大 5 到 20 倍是一个很好的选择。

请记住，对于 L2ARC 中的每个数据块，主 ARC 需要一个 88 字节的条目。这可能会导致 ARC 意外填充并降低前期设计不良的系统的性能。例如，填充 4KiB 块的 480GB L2ARC 在主 ARC 中需要超过 10GiB 的元数据存储。

##### 自加密驱动器

TrueNAS 支持两种形式的静态数据加密以实现隐私和合规性目标：[基于 ZFS 文件系统的加密](https://www.truenas.com/docs/core/storage/pools/storageencryption/)和[自加密硬盘 (SED)](https://www.truenas.com/docs/core/storage/sed/)。 SED 不会经历软件分区加密带来的性能开销，但不像普通硬盘那样容易购买（因此可能会花费更多的钱）。

##### 引导设备

从 8 GB 或更大的 U盘 启动旧版 FreeNAS 系统曾经非常流行，但是由于 USB 驱动器质量的巨大差异以及现代 TrueNAS 版本对启动池的驱动器写入增加，因此，所有直接销售的 [TrueNAS 硬件系统](https://www.truenas.com/docs/hardware/)都附带 M.2 驱动器或 SATA DOM。

SATA DOM 或磁盘模块提供接近消费级 2.5 英寸 SSD 的可靠性，外形更小，可安装到内部 SATA 端口，因此不占用驱动器托架。 因为 SATA DOM 和带有 m.2 插槽的主板不像这里提到的其他存储设备那么常见，所以推荐从 2.5 英寸 SSD 和 HDD（通常使用镜像以增加冗余）启动 TrueNAS 系统。 TrueNAS 启动卷的推荐大小为 8 GB，但使用 16 或 32 GB（或 120 GB 2.5” SATA SSD）可为更多启动环境提供空间。

##### 热插拔

TrueNAS CORE 系统有各种各样的功能。如果出现问题，您可能会非常希望能够从外部访问所有存储设备以进行有效更换。大多数热插拔驱动器托架需要一个专有驱动器托盘，您可以在其中安装每个驱动器。这些托架和托盘组合通常包括方便的功能，如活动卡口和识别灯，以可视化活动并使用 sesutil(8) 照亮故障驱动器（CORE版：https://www.freebsd.org/cgi/man.cgi?query=sesutil&sektion=8 ，SCALE版：https://manpages.debian.org/testing/sg3-utils/sg3_utils.8.en.html ）。 TrueNAS Mini 系统附带四个或更多热插拔托架。 TrueNAS R 系列系统可以在其主机和外部扩展架中支持数十个驱动器。二手或重新利用的硬件在 TrueNAS 用户中很受欢迎。注意给定系统的热插拔背板提供的最大性能。留意至少 6 Gbps SATA III 的支持。同时还需要注意，当前不支持热插拔 PCIe NVMe 设备。

### 存储设备大小调整

[Zpool 布局](https://www.truenas.com/docs/core/storage/pools/poolcreate/#vdev-layout)（LUN 和卷的组织，用 TrueNAS/ZFS 的说法）不在本指南的范围内。对于两位数的 TB 驱动器的可用性提出了一个问题，TrueNAS 用户现在可以奢侈地提问：我应该使用多少个驱动器来达到我想要的容量？虽然您可以镜像两个 16TB 驱动器以实现 16TB 的可用容量，但这并不意味着您应该这样做。镜像两个大驱动器提供了冗余和平衡两个设备之间读取的优势，这可以降低功耗，但除此之外几乎没有其它优势。两个大盘的写性能最多是单盘的。相比之下，八个 4TB 驱动器的阵列提供了广泛的配置，以更低的成本优化性能和冗余。如果配置为条带镜像，八个驱动器可以在相似的总容量下产生四倍的写入性能。您还可以考虑添加具有任何 zpool 配置的热备用驱动器，以便在 zpool 中的主驱动器发生故障时自动重建 zpool。

### 存储设备老化

根据定义，旋转磁盘硬盘驱动器具有活动部件。 这些部件对冲击和振动高度敏感，并且会随着使用而磨损。 考虑在将每个存储设备投入生产之前对其进行预测试，注意：

- 开始长时间的硬盘自检（可能需要 12+ 小时） (`smartctl -t long /dev/`), 
- 检查结果 (`smartctl -a /dev/`)
- 检查挂起的扇区重新分配 (`smartctl -a /dev/ | grep Current_Pending_Sector`)
- 检查重新分配的扇区数 (`smartctl -a /dev/ | grep Reallocated_Sector_Ct`)
- 检查 UDMA CRC 错误 (`smartctl -a /dev/ | grep UDMA_CRC_Error_Count`)
- 检查 HDD 和 SSD 写入延迟一致性，仅限未格式化的驱动器！ (`diskinfo -wS `) 
- 检查 HDD 和 SSD使用的小时数(`smartctl -a /dev/ | grep Power_On_Hours`)
- 检查已使用的 NVMe 百分比 (`nvmecontrol logpage -p 2 nvme0 | grep “Percentage used”`)

在部署系统以及创建池之前花点时间。 在测试过程中使其尽可能接近真实的工作负载，以揭示单个驱动器问题并帮助确定替代池布局是否更适合该工作负载。 小心二手的驱动器，因为供应商可能不诚实或不了解任何提供给您的驱动器的年龄和健康状况。使用`smartctl(8)` 检查所有“新”驱动器上的小时数以验证它们没有重新认证。 驱动器供应商还可以在重新认证期间将驱动器的小时数归零，从而掩盖其真实年龄。 iXsystems 会在发货前至少 48 小时对其销售的所有存储设备进行测试。

### 存储控制器

与 TrueNAS 一起使用的无可争议的最受欢迎的存储控制器是 6 和 12 Gbps（每秒千兆位，有时表示为 Gb/s）Broadcom（以前称为 Avago，以前称为 LSI）SAS 主机总线适配器 (HBA)。这些在某些主板上作为嵌入式控制器提供，但通常是具有四个或更多内部或外部 SATA/SAS 端口的 PCIe 卡。 6 Gbps LSI 9211 及其更名的同级产品也使用 LSI SAS2008 芯片，例如 IBM M1015 和戴尔 H200，在使用二手市场零件构建系统的 TrueNAS 用户中是传奇。刷写最新的 IT 或目标模式固件以禁用 Broadcom 控制器上“IR”固件中的可选 RAID 功能。对于那些有预算的人来说，Broadcom 9300/9400 系列等较新的型号提供 12 Gbps SAS 功能，甚至 9400 系列提供 NVMe 到 SAS 的转换功能。 TrueNAS 包括 `sas2flash`、`sas3flash` 和 `storcli` 命令，用于在 9200、9300 和 9400 系列卡上刷写固件或执行重新刷新操作。

板载 SATA 控制器在较小的版本中很受欢迎，但主板供应商通过包含比传统的四个 SATA 接口更多的接口来更好地满足 NAS 用户的需求。请注意，许多主板同时配备 3 Gbps 和 6 Gbps 板载 SATA 接口，选择错误的接口可能会影响性能。如果主板包含硬件 RAID 功能，请勿使用或配置它，但请注意，在 BIOS 中禁用它可能会删除某些 SATA 功能，具体取决于主板。大多数与 SATA 兼容性相关的问题很容易被发现。

有无数的警告反对将硬件 RAID 卡与 TrueNAS 一起使用。 ZFS 和 TrueNAS 提供内置 RAID，可以比任何硬件 RAID 卡更好地保护您的数据，无需任何硬件 RAID 卡。如果您拥有硬件 RAID 卡，则可以使用它，但也有限制。首先也是最重要的一点，不要使用他们的 RAID 设施（下面的要点中有一个警告）。如果选择的硬件 RAID 卡支持 HBA 模式，也称为“直通”或“JBOD”模式。使用时，它允许它执行与标准 HBA 没有区别的性能。如果您的 RAID 卡没有此模式，您可以为系统中的每个磁盘配置一个 RAID0。这并不理想，但它在紧要关头工作。如果将硬件 RAID 卡重新用于 TrueNAS，请注意某些硬件 RAID 卡：

- 可能会屏蔽磁盘序列号和 S.M.A.R.T.健康信息
- 执行速度可能比其 HBA 等效项慢
- 如果使用带有无效电池备份单元 (BBU) 的写缓存可能会导致数据丢失）

### SAS 扩展器

每个磁盘都连接到控制器卡上的接口的直连系统是最佳的，但并非总是可行。 SAS 扩展器是一个端口倍增器或分离器，它使控制器卡上的每个 SAS 端口能够为更多磁盘提供服务。 您只能在具有 12 个以上驱动器托架的服务器或 JBOD 的驱动器背板上找到 SAS 扩展器。 例如，[TrueNAS JBOD 仅在四个机架单位的空间内就超过了 90 个驱动器](https://www.truenas.com/docs/hardware/expansionshelves/es102bsg/)。 如果没有 SAS 扩展器的奇迹，这将是不可能的。 否则，想象一下访问 90 个驱动器需要多少个八端口 HBA！ 而专为 SAS 磁盘设计的 SAS 扩展器通常可以通过 SATA 隧道协议或 STP 支持 SATA 磁盘。 由于上述 NL-SAS 部分中提到的原因，SAS 磁盘仍然是首选，但 SATA 磁盘也可以在基于 SAS 的背板上运行。 请注意，您不能在专为 SATA 驱动器设计的端口中使用 SAS 驱动器。

### 存储设备散热装置

一项在互联网上被广泛引用的研究断言，驱动器温度对驱动器可靠性几乎没有影响。这项研究是一个很好的标题或话题的开场白，但仔细阅读报告表明，这些驱动器都在最佳环境条件下进行了测试。冷却良好的旋转硬盘在生产中达到的平均温度约为 28 °C，一项研究发现，温度每升高 12 °C，磁盘的故障次数就会增加一倍。在添加通常会带来额外噪音的驱动器散热器之前，尤其是在旧系统上，请认识到在数据中心或机柜中运行服务器而没有注意到内部冷却风扇设置为最低设置总是存在浪费金钱的风险。密切注意支持 16 个或更多驱动器的任何机箱中的驱动器温度，特别是如果它们是奇特的高密度设计。无论出于何种原因，每个机箱都有某些温度较高的区域。注意风扇故障以及某些型号的 8TB 驱动器运行温度高于其他驱动器容量的趋势。通常，尽量将驱动器温度保持在驱动器供应商的要求以下。

## 内存、CPU 和网络注意事项

### 内存大小

TrueNAS 比许多网络附加存储解决方案具有更高的内存要求，这是有充分理由的：它在共享服务、附加插件、Jails和虚拟机以及复杂的读取缓存之间共享动态随机存取内存（DRAM 或简单的 RAM）。 RAM 很少在 TrueNAS 系统上闲置，足够的 RAM 是保持最佳性能的关键。 您应该至少有 8 GB 的 RAM 用于基本的 TrueNAS 操作，最多可使用 8 个驱动器。 其他用例都有不同的 RAM 要求：

- 为 8 个之后添加的每个驱动器增加 1GB，以使大多数用例受益。
- 如果有更多客户端连接到 TrueNAS 系统，请添加额外的 RAM（通常）。 通过 iSCSI 支持大量高性能 VM 的 20 TB 池可能需要比存储存档数据的 200 TB 池更多的 RAM。 如果使用 iSCSI 来支持 VM，则计划使用至少 16 GB 的 RAM 以获得合理的性能，使用 32 GB 或更多的 RAM 以获得最佳性能。
- 为 winbind 内部缓存的目录服务添加 2 GB RAM。
- 根据插件和Jails的需要添加更多 RAM，因为每个插件和Jails都有特定的应用程序 RAM 要求。
- 为具有来宾操作系统和应用程序 RAM 要求的虚拟机添加更多 RAM。
- 如果使用基于ZFS的数据去重功能，请为每TB数据添加5GB内存。
- 为池中每 50 GB 的 L2ARC 添加大约 1 GB 的 RAM（保守估计）。 将 L2ARC 驱动器连接到池实际上也会使用一些 RAM。 ZFS 需要 ARC 中的元数据来了解 L2ARC 中的数据。

### 带有ECC(Error Correcting Code)功能的内存

计算机系统内部的电或磁干扰会导致 RAM 的单个位自发翻转到相反的状态，从而导致所谓的内存错误。 内存错误可能会导致安全漏洞、崩溃、转录错误、交易丢失以及数据损坏或丢失。

纠错码或 ECC RAM 检测并纠正发生的内存中位错误。 如果错误严重到无法纠正，ECC 内存会导致系统挂起（变得无响应），而不是继续处理错误位。 对于 ZFS 和 TrueNAS，这种行为实际上消除了 RAM 错误传递到驱动器导致 ZFS 池损坏或文件错误的任何可能性。

关于是否将纠错码 (ECC) 内存与 OpenZFS 和 TrueNAS 一起使用的在 Internet 范围内的冗长辩论总结如下：

- *强烈*推荐 ECC RAM 作为另一种数据完整性防御

然而：

- 只有部分 CPU 和主板支持 ECC RAM
- 许多 TrueNAS 系统在没有 ECC RAM 的情况下每天都在运行
- 任何类型或等级的 RAM 都可能出现故障并导致数据丢失
- RAM 最有可能在前三个月出现故障，因此请在部署前测试所有 RAM。

### 中央处理器 (CPU) 选择

选择 ECC RAM 会显着减少可用的 CPU 和主板选项，但这实际上是一件好事。 英特尔® 将 ECC RAM 支持限制在最低和最高端的 CPU 上，排除了中端 i5 和 i7 型号。

究竟选择哪种 CPU 可以归结为以下关键因素的简短列表：

- 由于 OpenZFS 校验和、压缩和（可选）加密数据的方式，功率不足的 CPU 可能会造成性能瓶颈。
- 由于 Samba（轻线程 TrueNAS SMB 守护程序）的存在，具有较少内核的高频 CPU 通常最适合仅用于 SMB 的工作负载。
- 更高核心数的 CPU 更适合并行加密和虚拟化。
- 支持 AES-NI 加密加速的 CPU 提高了文件系统和网络加密的速度。
- 服务器级 CPU 是最好的选择，推荐使用它们的电源和 ECC 内存支持。
- 对于软件加密池，Xeon E5 CPU（或类似的）是最好的选择。
- 对于虚拟机，Intel Ivy Bridge CPU 或更高版本是最好的选择。

注意 CPU 和主板上的 VT-d/AMD-Vi 设备虚拟化支持，以将 PCIe 设备传递给虚拟机。 请注意给定的 CPU 是否包含 GPU 或需要外部 GPU。 另请注意，许多服务器主板都包含带有内置 GPU 的 BMC 芯片。 有关 BMC 的更多详细信息，请参见下文。

由于 Ryzen 和 EPYC（Naples/Rome）系列，AMD CPU 正在卷土重来。 FreeBSD 和 TrueNAS CORE 对这些平台的支持相当有限。 但是有重要的 Linux 支持，TrueNAS SCALE 应该可以毫无问题地与 AMD CPU 一起使用。

### 远程管理：IPMI

为了进一步限制主板选择，如果您需要，请考虑智能平台管理接口或 IPMI，又名基板管理控制器（或 BMC、iLo、iDrac 和其他名称，具体取决于供应商）：

- 远程系统的远程电源控制和监控
- 用于配置或数据恢复的远程控制台外壳访问
- 用于 TrueNAS 安装或重新安装的远程虚拟媒体

TrueNAS 依赖于其基于 Web 的用户界面 (UI)。 但有时您可能需要控制台访问权限来更改网络配置。 TrueNAS 管理和共享默认为单个网络接口。 当需要升级时，这将成为一个挑战，例如 LACP 聚合网络。 理想的解决方案是拥有一个用于访问 TrueNAS Web UI 的专用子网，但并非所有用户都可以享受这种奢侈。 所以偶尔访问硬件控制台对于全局配置甚至系统恢复都是必要的。 最新的 TrueNAS Mini 和 R 系列系统在专用千兆网络接口上提供全功能、基于 HTML5 的 IPMI 支持。

### 电源

TrueNAS 系统上的电源单元（或 PSU）要考虑的首要标准是：

- 电源容量（以瓦为单位）及其必须支持的驱动器数量
- 可靠性
- 效率等级
- 相对噪声
- 如果一个电源出现故障，可选冗余以保持重要系统运行

选择一个额定为初始负载和未来负载的 PSU。拥有一个功率充足的 PSU，以应对未来从大型存储机箱迁移到满载机箱的计划。此外，请考虑使用可热插拔的冗余 PSU 来帮助保证正常运行时间。预算有限的用户可以保留一个冷备用 PSU，以将他们的潜在停机时间限制在数小时而不是数天。一个好的现代 PSU 是高效的，并且完全集成到 IPMI 管理系统中，以提供实时的风扇、温度和负载信息。

大多数电源具有经认证的效率等级，称为 80 Plus 等级。 80 Plus 评级表示从市电汲取的能量以热量、噪音和振动的形式损失，而不是像为组件供电那样做有用的工作。如果电源需要 600 瓦的输入功率来为您的组件提供 500 瓦的输出功率，则它的运行效率为 500/600 = ~83%。其他 100 瓦特会以热量、噪音和振动的形式损失掉。额定值较高的电源效率更高，但也可能贵得多。如果您不确定要购买什么效率，请进行一些计算。例如，如果 80 Plus Platinum PSU 的成本比可比的 80 Plus Gold 贵 50 美元，那么每年至少可以为您节省 10 美元的电费，以便在 5 年内收回投资。您可以在[这篇文章](https://www.tomshardware.com/news/what-80-plus-levels-mean,36721.html)中阅读有关 80 Plus 评分的更多信息。

### 不间断电源（UPS）

TrueNAS 能够通过传统的串行（COM）或 USB 连接与电池供电的不间断电源 (UPS) 进行通信，以在断电情况下协调正常关机。 TrueNAS 适用于 APC 品牌 UPS，其次是 CyberPower。 考虑对具有纯正弦波输出的 UPS 进行预算。 某些型号的 SSD 可能会在断电时遇到数据损坏。 如果多个 SSD 同时断电，则可能导致整个池故障，从而使 UPS 成为一项关键投资。

### 以太网

网络附加存储中的网络与存储一样重要，但主题归结为几个关键点：

- 简单 - 简单通常是网络配置可靠性的秘诀。
- 单个接口 - 更快的单个接口（例如 10/25/40/100GbE）比聚合较慢的接口更可取。
- 接口支持 - Intel 和 Chelsio 接口是受支持的最佳选项。
- 数据包碎片 - 仅考虑具有专用连接的巨型帧 [MTU](https://en.wikipedia.org/wiki/Maximum_transmission_unit)，例如不太可能遇到数据包碎片的服务器或视频编辑器和 TrueNAS 之间的连接。
- LRO/LSO 卸载功能 - 与 [LRO](https://en.wikipedia.org/wiki/Large_receive_offload) 和 [LSO](https://en.wikipedia.org/wiki/Large_send_offload) 卸载功能的接口通常可以减少对巨型帧的需求，并且使用它们可以降低 CPU 开销。

### 高速互连网

随着硬件的发展和企业升级速度的加快，更高速的硬件变得越来越容易获得。 家庭实验室现在可以部署和使用 40GB 及更高容量的网络组件。 家庭用户现在发现与企业客户发现的这些更高速度相同的问题和问题。

iXsystems 建议使用光纤通过直接连接铜 (DAC) 电缆进行下列高速互连：

- 10Gb 网卡: SFP+ 接口
- 25Gb 网卡: SFP28 接口
- 40Gb 网卡: QSFP+ 接口
- 100Gb 网卡: QSFP28 接口
- 200Gb 网卡: QSFP56 接口
- 400Gb 网卡: QSFP-DD 接口

iXsystems 还建议对使用光纤通道时提到的任何收发器使用光纤。 直连铜缆 (DAC) 可能会在 网卡、电缆和交换机之间产生互操作性问题。

## 虚拟化的 TrueNAS CORE

最后，最终的 TrueNAS 硬件问题是到底是使用实际硬件还是采用虚拟化解决方案。 TrueNAS 开发人员每天都将 TrueNAS 虚拟化作为他们工作的一部分，并且云服务在各种规模的用户中都很受欢迎。 TrueNAS 的设计以 OpenZFS 为核心。 设计，从第一天到使用物理存储设备。 当需要虚拟化 TrueNAS 时：

- 如果可能，将硬件磁盘或整个存储控制器传递给 TrueNAS VM（需要 VT-d/AMD-Vi 支持）。
- 禁用虚拟化存储（例如 VMFS）上的自动清理池，并且永远不要在另一层上执行存储修复任务时清理池。
- 使用至少三个 vdev 来提供足够的元数据冗余，即使使用条带池也是如此。
- 提供一个或多个 8GB 或更大的引导设备。
- 根据其通常的要求，为 TrueNAS VM 提供足够的 RAM。
- 如果所有设备都支持，请考虑巨型帧网络。
- 了解 FreeBSD 中的客户工具可能缺乏其他客户操作系统中的功能。
- 在虚拟接口上启用 MAC 地址欺骗并启用混杂模式以使用 VNET jail 和插件。

