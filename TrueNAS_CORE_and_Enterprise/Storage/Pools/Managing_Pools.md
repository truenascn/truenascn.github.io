# 存储池管理

创建数据存储池后，有多种选项可以更改该池的初始配置。 更改池可能会造成破坏，因此请确保您了解系统上的现有资源，并考虑在更改池之前备份任何存储的数据。 要查找现有池，请登录 Web 界面并转到存储（**Storage**） > 池（**Pools**）。

![](https://www.truenas.com/docs/images/CORE/12.0/StoragePoolsList.png)

这个页面会显示每个池的当前状态和存储使用情况。 要查看有关池的更多详细信息，请单击池条目右侧的 v 符号。 单击池管理选项的设置（齿轮）图标。

## 设置内容

### 存储池选项（Pool Options）

包含池的其他高级设置。

![](https://www.truenas.com/docs/images/CORE/12.0/StoragePoolsPoolOptions.png)

**Auto TRIM** 允许 TrueNAS 定期检查池磁盘中是否有可回收的存储块。 这可能会对池的性能产生影响，因此默认情况下禁用该选项。 有关 ZFS 中 TRIM 的更多详细信息，请参阅 [zpool.8](https://zfsonlinux.org/manpages/0.8.1/man8/zpool.8.html) 中的 autotrim 属性说明。

### 导出存储池/使存储池离线（Export/Disconnect）

从系统中删除池。 可用于准备驱动器以传输到新系统并导入池或完全删除池和存储在其上的任何数据。 一个对话框会警告断开池的风险，并显示受移除池影响的任何系统服务。

![](https://www.truenas.com/docs/images/CORE/12.0/StoragePoolsExportExample.png)

由于这是一种破坏性操作，因此在删除存储的数据时，必须勾选额外的复选框并手动输入池的名称。 当池断开连接时，也可以删除此数据的现有共享。



### 添加vdev（Add Vdevs）

这将打开池管理器（**Pool Manager**）以将更多 vdev 添加到池中。

![](https://www.truenas.com/docs/images/CORE/12.0/StoragePoolsAddCreateVdevs.png)

不允许更改原始加密和数据 vdev 配置。

默认情况下会选择新的数据 vdev。 要将不同类型的 vdev 添加到池中，请单击添加 VDEV（**ADD VDEV**） 并从下拉列表中选择类型。

添加磁盘以增加池容量时，ZFS 支持向现有 ZFS 池添加虚拟设备或 vdev。 创建 vdev 后，无法向该 vdev 添加更多驱动器，但可以将新 vdev 与另一个相同类型的 vdev 条带化，以增加池的整体大小。 要扩展池，添加的 vdev 必须与现有 vdev 的类型相同。

一些 vdev 扩展示例：

- 要扩展 ZFS 镜像，请添加相同数量的驱动器。 结果是一个镜像的条带。 例如，如果有十个新驱动器可用，则最初可以创建两个驱动器的镜像，然后通过添加另一个两个驱动器的镜像进行扩展，再重复三次，直到添加了所有十个驱动器。
- 要扩展三驱动器 RAIDZ1，请添加另外三个驱动器。 生成的池是两个 RAIDZ1 vdev 的条带，类似于硬件控制器上的 RAID 50。
- 要扩展四驱动器 RAIDZ2，请添加另外四个驱动器。 结果是 RAIDZ2 vdev 的条带，类似于硬件控制器上的 RAID 60。
- 添加一个磁盘作为*热备用*到池中。



### 清理存储池（Scrub Pool）

启动池的数据完整性检查。 在清理过程中检测到的任何问题都会自动更正，或者会在 Web 界面中生成警报。 默认情况下，每个池都会根据重复的清理计划自动检查。

### 存储池状态（Status）

打开池状态（**Pool Status**）页面以显示池中最后一次清理和磁盘的状态。

![](https://www.truenas.com/docs/images/CORE/12.0/StoragePoolsStatus.png)

此页面中提供了用于管理连接磁盘的其他选项。

### 扩展存储池（Expand Pool）

增加池的大小以匹配所有可用磁盘空间。 此选项通常用于在除 TrueNAS 之外调整虚拟磁盘大小时。

### 升级存储池（Upgrade Pool）

此选项仅在池可以升级以使用新的 ZFS 功能标志时出现。 在升级现有池之前，请注意以下注意事项：

- 升级池是一种方式，这意味着如果您改变主意，则无法返回到较早的 ZFS 版本或降级到不支持这些 ZFS 功能的较早版本的软件。
- 在执行任何可能影响存储磁盘上数据的操作之前，始终先备份所有数据并验证备份的完整性。 虽然池升级不太可能影响数据，但安全总比后悔好。
- 升级 ZFS 池是可选的。 如果需要恢复到较早版本的 TrueNAS 或在另一个支持 ZFS 的操作系统中重新调整磁盘用途，请不要升级池。 除非最终用户对较新的 ZFS 功能标志有特定需求，否则没有必要升级池。 如果池升级到最新的功能标志，则无法将该池导入到尚不支持这些功能标志的另一个操作系统中。

升级本身只需几秒钟，并且不会造成中断。 无需停止任何共享服务来升级池。 但是，最好在池没有被大量使用时进行升级。 升级过程将暂停 I/O 一小段时间，但在安静的池中几乎是瞬时的。

