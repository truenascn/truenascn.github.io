# 引导备份

TrueNAS 支持一种被称为引导环境的 ZFS 功能。 在TrueNAS 可以启动的快照克隆中只能使用一个引导环境进行引导。

引导备份允许重新引导到特定时间点，并极大地简化了从系统错误配置或其他潜在系统故障中恢复的过程。 有了多个引导备份，更新操作系统的过程就变成了一个低风险的操作。 更新程序会自动创建当前引导环境的快照备份，并在应用更新之前将其添加到引导菜单中。 如果更新过程中出现任何问题，系统管理员可以将 TrueNAS 引导到以前的环境中以恢复系统功能。

转至系统（**System**） > 引导（**Boot**）以查看启动环境列表。

## 管理引导备份

要查看系统上的引导备份列表，请转至系统（**System**） > 引导（**Boot**）。 每个引导备份条目都包含以下信息：

1、名称（**Name**）：出现在引导菜单中的引导条目的名称。
2、活动状态（**Active**）：标明如果引导环境未处于活动状态，默认情况下由哪个条目引导。
3、创建日期（**Created**）：表示引导环境的创建日期和时间。
4、空间（**Space**）：显示引导备份快照占用的空间大小。
5、删除保护（**Keep**）：指示当系统更新没有足够空间运行时，TrueNAS 是否自动删除此引导备份。

要访问引导备份的更多选项，请单击右侧的三个点。



激活（**Activate**）：仅出现在当前未设置为活动的条目上。 激活环境意味着系统将在下次启动时引导至该备份中保存的时间点。 状态变为 Reboot，当前 Active 条目从 Now/Reboot 变为 Now，表明它是当前启动的环境，但不会在下次启动时使用。

克隆（**Clone**）：将选定的引导备份复制到新条目中。 克隆名称只允许使用字母数字字符，允许使用破折号 (-)、下划线 (_) 和句点 (.)。

重命名（**Rename**）：更改引导备份名称。 允许使用字母数字字符、破折号 (-)、下划线 (_) 和句点 (.)。

删除（**Delete**）：删除突出显示的条目，并从引导菜单中删除该条目。 无法删除默认条目和任何活动条目。 由于无法删除激活的条目，因此活动引导中不会出现此按钮。 要删除当前活动的条目，请先激活另一个条目。

删除保护（**Keep**）如果没有足够的空间来继续更新，则切换更新程序是否可以自动删除此引导备份。

## 引导操作

单击操作（**ACTIONS**）以：

添加（**Add**）：从活动引导创建一个新的引导备份：

![](https://www.truenas.com/docs/images/CORE/12.0/SystemBootActionsAdd.png)

名称中只允许使用字母数字字符、破折号 (-) 和下划线 (_)。 命名新的引导备份并单击提交（**SUBMIT**）。

统计/设置（**Stats/Settings**）：显示操作系统设备的统计信息：状况（**condition**）、总大小（**total**）和已用大小（**used size**），以及上次自动清理的日期和时间（**date and time**）。 默认情况下，TrueNAS每 7 天自动清理一次。 要更改默认值，请在自动清理间隔（以天为单位）字段中输入不同的数字，然后单击更新间隔（**UPDATE INTERVAL**）。

引导池状态（**Boot Pool Status**）：显示操作系统设备（引导池）中每个设备的状态，包括任何读取、写入或校验和错误。

清理启动池（**Scrub Boot Pool**）：对操作系统设备执行手动“清理”（数据完整性检查）。

## 回滚引导

有时，回滚到较旧的引导环境会很有用。 例如，如果更新过程没有按计划进行，很容易回滚到以前的引导备份。 TrueNAS 在系统更新时自动创建引导备份。

回滚引导有两种不同的方法：使用 Web 界面和通过命令行界面 (CLI)

### 使用Web 界面回滚引导

要激活不同的引导备份，请转至系统（**System**） > 引导（**Boot**）并单击所需要回滚到的引导备份的右边的三个点。 接下来，单击激活（**Active**）。 此引导备份在 Active 列中显示 Reboot。 这意味着引导环境在下次系统引导时变为活动状态。 系统配置也会更改为创建引导备份时的状态。

### 使用命令行界面回滚引导环境

如果无法访问 Web 界面，但您仍然可以物理访问系统，则可以在 CLI 的欢迎屏幕上更改引导环境。

重新启动系统。 当欢迎屏幕出现时，按与选项引导环境对应的键。 在下图中，选择 Boot Environments 选项的键是 7。

**注意：如果不存在之前备份的其他引导，则不会出现引导备份选项。**

![](https://www.truenas.com/docs/images/CORE/12.0/BootMenu.png)

选择 Boot Environment 选项后，选择要激活的新引导备份。 按下 Active: 选项对应的键。 在下图中，按键为 2。

![](https://www.truenas.com/docs/images/CORE/12.0/BootMenuSelectBE.png)

按键循环浏览现有的引导环境。 选择所需的引导环境后，按 Backspace 返回欢迎菜单。 然后，按 4 重新启动系统。 系统重新引导时将使用选定的引导备份。

