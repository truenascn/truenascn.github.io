# SSH客户端

安全套接字外壳 (SSH) 是一种网络协议，它提供了一种在使用不安全网络时在两台主机之间访问和传输文件的安全方法。 SSH 可以使用用户帐户凭据来建立安全连接，但通常使用主机系统之间共享的密钥对进行身份验证。

## 创建 SSH 密钥对

TrueNAS 在系统（ **System**） > SSH密钥对（**SSH Keypairs**）中生成和存储 [RSA 加密](https://tools.ietf.org/html/rfc8017)的 SSH 公钥和私钥对。 这些通常在配置 SSH 连接或 SFTP 云凭据时使用。 不支持加密的密钥对或带有密码的密钥对。

创建新的 SSH 连接（**SSH Connections**）或复制（**Replication**）任务时，会根据需要自动生成密钥对。 要手动生成新的密钥对，请转至系统（ **System**） > SSH密钥对（**SSH Keypairs**），单击添加（*ADD*），然后为密钥对指定唯一名称。

![](https://www.truenas.com/docs/images/CORE/12.0/SystemSSHKeypairsAdd.png)

单击按钮生成密钥对将值添加到公钥和私钥字段。 复制这些字符串或将它们下载到文本文件中以备后用。

## SSH 连接

### 半自动连接

TrueNAS 提供半自动设置模式，可简化与另一个 FreeNAS 或 TrueNAS 系统的 SSH 连接设置，而无需登录该系统以传输 SSH 密钥。 这需要本地系统上的 SSH 密钥对和远程 TrueNAS 的管理员帐户凭据。 远程系统还必须配置为允许使用 SSH 进行 root 访问。 密钥对可以作为半自动配置的一部分生成，也可以在系统（ **System**） > SSH密钥对（**SSH Keypairs**）中手动创建。

转至系统 > SSH 连接，然后单击添加。

![](https://www.truenas.com/docs/images/CORE/12.0/SystemSSHConnectionsAddSemiAuto.png)

| 项目名称                     | 描述                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| 名称（**Name**）             | 此 SSH 连接的名称。 SSH 连接名称必须是唯一的。               |
| 设置方法（**Setup Method**） | *手动*需要在远程系统上配置身份验证。 这可能包括复制 SSH 密钥和修改该系统上的 root 用户帐户。 *半自动* 仅在配置与远程 TrueNAS 系统的 SSH 连接时有效。 此方法使用远程系统的 URL 和登录凭据来连接和交换 SSH 密钥。 |

验证凭据

| 项目名称                          | 描述                                                         |
| --------------------------------- | ------------------------------------------------------------ |
| TrueNAS系统URL（**TrueNAS URL**） | 远程系统的主机名或 IP 地址。 需要有效的 URL 方案。 示例：`https://10.231.3.76` |
| 用户名（**Username**）            | 用于登录远程系统的用户名。                                   |
| 密码（**Password**）              | 用于登录远程系统的用户帐户密码。                             |
| 私钥（**Private Key**）           | 选择已保存的 SSH 密钥对或选择“生成新”以创建新的密钥对并将其用于此连接。 |

其它选项

| 项目名称                        | 描述                                                         |
| ------------------------------- | ------------------------------------------------------------ |
| 加密方式（**Cipher**）          | *标准*最安全，但对连接速度的影响最大。 *快速*不如标准安全，但可以为加密速度有限的设备提供合理的传输速率。 *已禁用* 删除所有安全性，以最大限度地提高连接速度。 禁用安全性只能在安全、受信任的网络中使用。 |
| 连接超时（**Connect Timeout**） | 系统停止尝试与远程系统建立连接之前的时间（以秒为单位）。     |

确保对远程 TrueNAS URL 使用有效的 URL 方案。 将用户名保留为 root 并输入远程 TrueNAS 系统的帐户密码。 私钥可以从之前创建的 SSH 密钥对导入，也可以使用新的 SSH 密钥对创建。

保存新配置会自动打开与远程 TrueNAS 的连接并交换 SSH 密钥。

### 手动连接

选择手动设置 SSH 连接需要将公共加密密钥从本地系统复制到远程系统。 这允许在没有密码提示的情况下进行安全连接。

#### 将公共 SSH 密钥添加到 TrueNAS root帐户

登录到生成 SSH 密钥对的 TrueNAS 系统，然后转到系统（ **System**） > SSH密钥对（**SSH Keypairs**）。 打开用于 SSH 连接的密钥对并复制公共 SSH 密钥的文本或将公共密钥下载为文本文件。

登录需要注册公钥的TrueNAS系统，进入帐户（**Accounts**） > 用户（**Users**）。 编辑根帐户。 将 SSH 公钥文本粘贴到 SSH 公钥（**SSH Public Key** ）字段中。

![](https://www.truenas.com/docs/images/CORE/12.0/AccountsUsersRootSSHKey.png)

首先在系统（ **System**） > SSH密钥对（**SSH Keypairs**）中生成一个新的 SSH 密钥对。 复制或下载公钥的值。 需要将公钥添加到远程 NAS。 当远程 NAS 不是 TrueNAS 系统时，请参阅该系统的文档以获取有关添加公共 SSH 密钥的说明。

#### 在本地 TrueNAS 上手动配置 SSH 连接

重新登录到本地 TrueNAS 系统并转到系统（**System**） > SSH 连接（**SSH Connections**）并添加新连接。 将设置方法更改为手动（**Manual**）。

![](https://www.truenas.com/docs/images/CORE/12.0/SystemSSHConnectionsAddManual.png)

| 项目名称                     | 描述                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| 名称（**Name**）             | 此 SSH 连接的名称。 SSH 连接名称必须是唯一的。               |
| 设置方法（**Setup Method**） | *手动*需要在远程系统上配置身份验证。 这可能包括复制 SSH 密钥和修改该系统上的 root 用户帐户。 *半自动* 仅在配置与远程 TrueNAS 系统的 SSH 连接时有效。 此方法使用远程系统的 URL 和登录凭据来连接和交换 SSH 密钥。 |

验证凭据

| 项目名称                              | 描述                                                         |
| ------------------------------------- | ------------------------------------------------------------ |
| 主机（**Host**）                      | 远程系统的主机名或 IP 地址。 需要有效的 URL 方案。 示例：`https://10.231.3.76` |
| 端口（**Port**）                      | 用于 SSH 连接的远程系统上的端口号。                          |
| 用户名（**Username**）                | 用于登录远程系统的用户名。                                   |
| 私钥（**Private Key**）               | 选择保存的 SSH 密钥对或选择 *Generate New* 以创建新的密钥对并将其用于此连接。 |
| 远程计算机私钥（**Remote Host Key**） | 此系统用于验证连接的远程系统 SSH 密钥。 正确配置所有其他字段后，单击*DISCOVER REMOTE HOST KEY* 查询远程系统并自动填充此字段。 |

发现远程主机，用密钥连接到远程主机并尝试将密钥字符串自动复制到相关的 TrueNAS 字段中。

其它选项

| 项目名称                        | 描述                                                         |
| ------------------------------- | ------------------------------------------------------------ |
| 加密方式（**Cipher**）          | *标准*最安全，但对连接速度的影响最大。 *快速*不如标准安全，但可以为加密速度有限的设备提供合理的传输速率。 *已禁用* 删除所有安全性，以最大限度地提高连接速度。 禁用安全性只能在安全、受信任的网络中使用。 |
| 连接超时（**Connect Timeout**） | 系统停止尝试与远程系统建立连接之前的时间（以秒为单位）。     |

确保从用于在远程 NAS 上传输公钥的 SSH 密钥对中选择私钥。