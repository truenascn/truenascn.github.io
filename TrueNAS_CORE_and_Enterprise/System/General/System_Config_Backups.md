# 系统设置备份

我们强烈建议定期备份系统配置。 如果系统遇到任何问题，这样做会在迁移、恢复或修复系统时保留设置。 每次系统配置更改时保存配置文件。

## 手动备份

要备份系统配置，请转至系统（**System**） > 常规（**General**）并单击保存配置（**SAVE CONFIG**），然后输入您的密码。

![](https://www.truenas.com/docs/images/CORE/12.0/SaveUploadResetConfig.png)

**注意：配置文件包含有关 TrueNAS 系统的敏感数据。 确保将其存放在安全的地方。**

## 自动备份

TrueNAS 会在每天凌晨 3:45（相对于系统时间设置）自动将配置数据库备份到系统数据集。 但是，如果当时系统关闭，则不会进行此备份。 当系统数据集存储在引导池中并且引导池变得不可用时，备份也会失去可用性。

**注意：SSH 密钥不存储在配置数据库中，必须单独备份。 系统主机密钥是 /usr/local/etc/ssh/ 中名称以 *ssh_host_* 开头的文件。 root 用户密钥存储在 /root/.ssh 中。**

## 备份密码

系统备份影响两种类型的密码：散列和加密：

| 散列                                                         | 加密                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| TrueNAS 将基本操作系统的用户帐户密码存储为散列值。 系统会将它们保存在系统配置备份中，因此它们不需要加密以确保安全。 | 系统将以加密形式保存其他密码，例如 iSCSI CHAP 密码、Active Directory 绑定凭据和云凭据，以防止它们在保存的系统配置中以纯文本形式显示。 此加密的密钥或种子通常仅存储在操作系统设备上。 |

单击 **SAVE CONFIG** 后有两个选项：

1、导出密码秘密种子，并在配置文件中包含加密的密码。 这允许将配置恢复到解密种子不存在的不同设备。 用户必须物理保护包含种子的配置备份，以防止未经授权的访问或密码解密。
2、导出旧版加密 (GELI) 密钥，并在配置文件中包含加密的旧版加密密钥。 用户可以通过使用 **UPLOAD CONFIG** 将配置文件上传到系统来恢复加密密钥。

![](https://www.truenas.com/docs/images/CORE/12.0/SaveConfiguration.png)

## 备份内容

备份配置存储帐户、网络、服务和系统设置的信息，以及任务和虚拟机的设置。
备份配置还为帐户、网络和系统服务建立索引 ID 和凭据。 用户可以使用 [SQLite DB Browser](https://sqlitebrowser.org/dl/) 等数据库查看软件查看备份配置的内容。

## 重置和恢复配置

### 重置配置

用户可以通过转至系统（**System**） > 常规（**General**）并单击重置配置（**RESET CONFIG**）将其系统配置重置为出厂设置。

| 注意：在重置配置之前保存系统的当前配置。如果您在重置之前不保存系统配置，您可能会丢失任何未备份的数据并且无法恢复之前的设置。 |
| ------------------------------------------------------------ |

重置系统配置后，系统将重新启动，您必须设置新的登录密码。

### 恢复配置

用户可以通过转到系统（**System**） > 常规（**General**）并单击上传配置（**UPLOAD CONFIG**）来恢复配置。

上传配置时，用户可以为他们的系统选择任何以前保存的配置文件。

