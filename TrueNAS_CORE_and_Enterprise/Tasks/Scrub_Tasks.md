# 清理任务

“清理”是指 ZFS 扫描池中的数据。 Scrub 识别数据完整性问题，检测由暂时性硬件问题引起的静默数据损坏，并提供早期磁盘故障警报。

## 默认清理任务

默认情况下，TrueNAS 在您创建新池时会创建清理任务。 擦洗的默认计划是每周日凌晨 12:00 运行。 要编辑默认清理，请转至任务（**Tasks**） > 清理任务（**Scrub Tasks**），单击右侧的三个小店 ，然后编辑。

## 创建新的清理任务

在创建清理任务之前，必须存在数据池。

要为池创建清理任务，请转至任务（**Tasks**） > 清理任务（**Scrub Tasks**）并单击添加（**ADD**）。

![](https://www.truenas.com/docs/images/CORE/12.0/TasksScrubTasksAdd.png)

选项

| 项目名称                     | 描述                                                         |
| ---------------------------- | ------------------------------------------------------------ |
| 数据池（**Pool**）           | 选择要的游泳池。                                             |
| 门槛天数(**Threshold days**) | 间隔几天再次允许运行完成的清理。 这控制了任务计划。 例如，安排清理每天运行并将阈值天数设置为 7 意味着清理尝试每天运行。 清理成功后，它会继续每天检查一次，但直到 7 天后才会再次运行。 使用 7 的倍数可确保擦洗始终在同一工作日进行。 |
| 描述（**Description**）      | 描述清理任务。                                               |
| 日程（**Schedule**）         | 多久运行一次清理任务。 选择预设之一或 自定义（**Custom**） 以使用高级计划程序（**Advanced Scheduler**）。 |
| 启用（**Enabled**）          | 取消勾选以禁用此清理计划而不删除它。                         |

### 高级计划程序

![](https://www.truenas.com/docs/images/CORE/12.0/TasksAdvancedScheduler.png)

选择预设会填充其余字段。要自定义计划，请按照`Minutes/Hours/Days`输入 [crontab](https://www.freebsd.org/cgi/man.cgi?crontab%285%29) 值。

请填写标准的 cron 值。最简单的选择是在字段中输入一个数字。当时间值与该数字匹配时，任务将运行。例如，输入 10 表示任务在时间过十分钟时运行。

星号 (*) 表示“匹配所有值”。

通过输入带连字符的数字值来设置特定的时间范围。例如，在“分钟”（**Minutes**）字段中输入 30-35 会将任务设置为在 30、31、32、33、34 和 35 分钟运行。

也可以输入值列表。输入由逗号 (,) 分隔的各个值。例如，在“小时”（**Hours**）字段中输入 1,14 表示任务在凌晨 1:00 (0100) 和下午 2:00 (1400) 运行。

斜线 (/) 表示步长值。例如，在 "日期"（**Days**） 中输入 * 表示该任务在每月的每一天运行，*/2 表示该任务每隔一天运行一次。

将上述所有示例结合在一起，可以创建一个计划，在每天凌晨 1:30-1:35 和下午 2:30-2:35 每分钟运行一次任务。

有一个选项可以选择任务运行的月份。不设置每个月与选择每个月相同。

星期几安排任务在特定的日子运行。这是对任何列出的天数的补充。例如，在日期中输入 1 并将 **Wed** 设置为 **Days of Week** 会创建一个计划，该计划在每月的第一天和每月的每个星期三启动任务。

计划预览（**Schedule Preview**）显示当前设置的任务运行的时间。

#### CRON 语法示例

| 句法                | 含义                                                       | 例子                                                         |
| ------------------- | ---------------------------------------------------------- | ------------------------------------------------------------ |
| *                   | 每一项。                                                   | * (minutes) = 每小时的每个特定分钟. * (days) = 每天.         |
| */N                 | 每 N 个项目                                                | */15 (minutes) = 每小时的第 15 分钟（每刻钟）。 */3 (days) = 每 3 天。 */3 (months) = 每三个月一次。 |
| 逗号和连字符/破折号 | 每个陈述的项目（逗号） 范围内的每个项目（连字符/破折号）。 | 1,31 (minutes) = 在每小时的第 1 分钟和第 31 分钟。 1-3,31 (minutes) = 每小时的第 1 分钟到第 3 分钟，以及第 31 分钟。 mon-fri (days) = 每周一至周五（包括每个工作日）。 mar,jun,sep,dec (months) = 每年三月、六月、九月、十二月。 |

天数可以指定为一个月的天数或一周的天数。

使用这些选项，可以创建类似于以下示例的灵活计划：

| 想要的时间表                                                 | 要输入的值                                                   |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 每天 3 次（午夜、08:00 和 16:00）                            | months=*; days=*; hours=0/8 or 0,8,16; minutes=0 (Meaning: every day of every month, when hours=0/8/16 and minutes=0) |
| 每周一、周三和周五，晚上 8.30                                | months=*; days=mon,wed,fri; hours=20; minutes=30             |
| 每月的第 1 天和第 15 天，10 月至 6 月，上午 00:01            | months=oct-dec,jan-jun; days=1,15; hours=0; minutes=1        |
| 工作日内每 15 分钟一次，即周一至周五上午 8 点至晚上 7 点（08:00 - 19:00） | Note that this requires two tasks to achieve: (1) months=*; days=mon-fri; hours=8-18; minutes=*/15 (2) months=*; days=mon-fri; hours=19; minutes=0 We need the second scheduled item, to execute at 19:00, otherwise we would stop at 18:45. Another workaround would be to stop at 18:45 or 19:45 rather than 19:00. |
