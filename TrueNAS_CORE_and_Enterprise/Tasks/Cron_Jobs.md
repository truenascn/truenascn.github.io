# 定时任务



TrueNAS 允许用户使用 [cron(8)](https://man.openbsd.org/cron.8) 定期运行特定命令或脚本。 这对于运行重复性任务很有帮助。

## 创建定时任务

要创建定时任务，转至任务（**Tasks**）->定时任务（**Cron Jobs**），然后单击添加（**ADD**）。

![](https://www.truenas.com/docs/images/CORE/12.0/TasksCronJobsAdd.png)

描述（**Description**）可选，填写此项有助于确定这个定时任务的目的。

接下来，输入要在计划上运行的确切命令（**Command**）， 或输入要运行的脚本文件的路径。

注意：在使用脚本文件的路径时，不要忘记定义 shell 类型。 例如，为 sh 编写的脚本必须指定为 `sh /mnt/pool1/helloWorld.sh`。

选择具有运行命令或脚本所需权限的现有 TrueNAS 用户帐户。

接下来，定义命令调度。TrueNAS 提供各种预设时间表，此外还有一个高级调度程序可以满足非常特定的调度要求。

### 高级调度程序

![](https://www.truenas.com/docs/images/CORE/12.0/TasksAdvancedScheduler.png)

选择预设会填充其余字段。要自定义计划，请按照`Minutes/Hours/Days`输入 [crontab](https://www.freebsd.org/cgi/man.cgi?crontab%285%29) 值。

请填写标准的 cron 值。最简单的选择是在字段中输入一个数字。当时间值与该数字匹配时，任务将运行。例如，输入 10 表示任务在时间过十分钟时运行。

星号 (*) 表示“匹配所有值”。

通过输入带连字符的数字值来设置特定的时间范围。例如，在“分钟”（**Minutes**）字段中输入 30-35 会将任务设置为在 30、31、32、33、34 和 35 分钟运行。

也可以输入值列表。输入由逗号 (,) 分隔的各个值。例如，在“小时”（**Hours**）字段中输入 1,14 表示任务在凌晨 1:00 (0100) 和下午 2:00 (1400) 运行。

斜线 (/) 表示步长值。例如，在 "日期"（**Days**） 中输入 * 表示该任务在每月的每一天运行，*/2 表示该任务每隔一天运行一次。

将上述所有示例结合在一起，可以创建一个计划，在每天凌晨 1:30-1:35 和下午 2:30-2:35 每分钟运行一次任务。

有一个选项可以选择任务运行的月份。不设置每个月与选择每个月相同。

星期几安排任务在特定的日子运行。这是对任何列出的天数的补充。例如，在日期中输入 1 并将 **Wed** 设置为 **Days of Week** 会创建一个计划，该计划在每月的第一天和每月的每个星期三启动任务。

计划预览（**Schedule Preview**）显示当前设置的任务运行的时间。

#### CRON 语法示例

| 句法                | 含义                                                       | 例子                                                         |
| ------------------- | ---------------------------------------------------------- | ------------------------------------------------------------ |
| *                   | 每一项。                                                   | * (minutes) = 每小时的每个特定分钟. * (days) = 每天.         |
| */N                 | 每 N 个项目                                                | */15 (minutes) = 每小时的第 15 分钟（每刻钟）。 */3 (days) = 每 3 天。 */3 (months) = 每三个月一次。 |
| 逗号和连字符/破折号 | 每个陈述的项目（逗号） 范围内的每个项目（连字符/破折号）。 | 1,31 (minutes) = 在每小时的第 1 分钟和第 31 分钟。 1-3,31 (minutes) = 每小时的第 1 分钟到第 3 分钟，以及第 31 分钟。 mon-fri (days) = 每周一至周五（包括每个工作日）。 mar,jun,sep,dec (months) = 每年三月、六月、九月、十二月。 |

天数可以指定为一个月的天数或一周的天数。

使用这些选项，可以创建类似于以下示例的灵活计划：

| 想要的时间表                                                 | 要输入的值                                                   |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 每天 3 次（午夜、08:00 和 16:00）                            | months=*; days=*; hours=0/8 or 0,8,16; minutes=0 (Meaning: every day of every month, when hours=0/8/16 and minutes=0) |
| 每周一、周三和周五，晚上 8.30                                | months=*; days=mon,wed,fri; hours=20; minutes=30             |
| 每月的第 1 天和第 15 天，10 月至 6 月，上午 00:01            | months=oct-dec,jan-jun; days=1,15; hours=0; minutes=1        |
| 工作日内每 15 分钟一次，即周一至周五上午 8 点至晚上 7 点（08:00 - 19:00） | Note that this requires two tasks to achieve: (1) months=*; days=mon-fri; hours=8-18; minutes=*/15 (2) months=*; days=mon-fri; hours=19; minutes=0 We need the second scheduled item, to execute at 19:00, otherwise we would stop at 18:45. Another workaround would be to stop at 18:45 or 19:45 rather than 19:00. |

附加选项：当隐藏标准输出 (stdout) 未设置时，任何标准输出都会邮寄到用于运行命令的用户帐户。
当隐藏标准错误 (stderr) 未设置时，任何错误输出都会通过邮件发送到用于运行命令的用户帐户。 如果发生错误，这有助于调试命令或脚本。
取消设置启用（**Enabled**）只会阻止任务自动运行。 您仍然可以保存 cron 作业并手动运行它。

## 管理定时任务

要查看所有创建的 定时任务，请转到任务（**Tasks**）->定时任务（**Cron Jobs**）。 单击条目旁边的 > 以查看详细信息和选项。

![](https://www.truenas.com/docs/images/CORE/12.0/TasksCronJobsOptions.png)

单击现在运行 (**RUN NOW**) 立即启动命令。 编辑（**EDIT**） 更改任务创建期间可用的任何设置。 删除（**DELETE**） 从 TrueNAS 中删除选定的定时任务。 定时任务一旦被删除，任务配置将无法恢复。